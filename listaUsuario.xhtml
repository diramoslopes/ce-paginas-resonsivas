<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      template="/WEB-INF/templates/Layout.xhtml">

	<h:head>
		<script type="text/javascript">
			function handleEdita(xhr, status, args) {
				if (!args.validationFailed) {
					editaUsuarioDialog.hide();
				}
			}
		</script>
	</h:head>

	<ui:define name="conteudo">

		<h:form id="form01Id">

			<p:panel id="panel01Id" header="Lista de Usuários" toggleable="true">
			
				<p:toolbar style="margin: 10px 0;">
				
					<p:toolbarGroup align="right">
						<p:commandButton value="Novo usuario" action="#{usuarioMBean.novo()}" onclick="PF('novoUsuarioDialog').show()"/>
					</p:toolbarGroup>
				
				</p:toolbar>
			
			  	<p:dataTable id="dataTable01Id" 
			  				 var="usuario" value="#{usuarioMBean.usuarios}" 
			  				 filteredValue="#{usuarioMBean.usuariosFiltrados}" 
			  				 widgetVar="usuarioTable"
			  				 selectionMode="single" selection="#{usuarioMBean.usuario}"
       						 rowKey="#{usuario.codigo}"
			  				 reflow="true" >
			  				 
			  		<p:ajax event="rowSelect" update="selectButtonId deleteButtonId"/>
			  		
			  		<p:ajax event="rowUnselect" update="selectButtonId deleteButtonId"/>
			     	
			     	<p:column id="nomeColumnId" headerText="Nome:" filterBy="#{usuario.funcionario.nome}" >
			         	<p:outputLabel value="#{usuario.funcionario.nome}" />
			    	</p:column>
			    	
			     	<p:column id="loginColumnId" headerText="Login:" filterBy="#{usuario.login}" >
			         	<p:outputLabel value="#{usuario.login}" />
			     	</p:column>
			     	
			     	<p:column id="opcoesColumnId" headerText="Opções:">
			     	
				         <p:commandButton id="selectButtonId" update=":form02Id:display01Id" oncomplete="editaUsuarioDialog.show()" icon="fa fa-pencil" title="Editar" style="width:25px"
				        	 disabled="#{not usuarioMBean.usuarioSeleciona}">
			               <f:setPropertyActionListener value="#{usuario}" target="#{usuarioMBean.usuario}" />
			          	</p:commandButton>
			          	
			           	<p:commandButton id="deleteButtonId" update=":form01Id:dataTable01Id" icon="fa fa-trash" title="Excluir" onclick="dlg1.show()" style="width:25px"
			           		disabled="#{not usuarioMBean.usuarioSeleciona}">
			            	<f:setPropertyActionListener value="#{usuario}" target="#{usuarioMBean.usuario}" />
			           	</p:commandButton>
			           	
			     	</p:column>
			     	
			     	<p:spacer height="10px"/>
			     	
			     	<f:facet name="footer">
			  			Total de #{fn:length(usuarioMBean.usuarios)} registro(s).
			  		</f:facet>
			  		
			  	</p:dataTable>
			  	
			</p:panel>

		</h:form>

		<p:dialog header="Editar Usuário" widgetVar="editaUsuarioDialog" resizable="false" id="editaUsuarioDlgId" showEffect="fade" hideEffect="fade" width="800" position="center" style="font-size:16px">
			
			<h:form id="form02Id">
			
				<p:panel id="panel02Id">
				
					<p:messages id="msgs2" autoUpdate="true"/>
					
					<p:panelGrid id="display01Id" columns="2" cellpadding="6" style="font-size:12px; font-family:Verdana">
					
							<p:outputLabel value="Funcionário:" for="funcionario"/>
							<p:selectOneMenu id="funcionario" value="#{usuarioMBean.usuario.funcionario.codigo}" required="true" requiredMessage="É necessário selecionar um funcionário">
								<f:selectItems value="#{selectOneMenuMBean.listaFuncionarios}"/>
							</p:selectOneMenu>
							
							<p:outputLabel value="Login:" for="login"/>
			  				<p:inputText id="login" value="#{usuarioMBean.usuario.login}"  required="true" requiredMessage="É necessário informar o login do usuário"/>
			  				
			  				<p:outputLabel value="Senha:" for="senha1"/>
			            	<p:password id="senha1" value="#{usuarioMBean.usuario.senha}" match="senha2" validatorMessage="As senhas informadas são diferentes"/>
			            	
			            	<p:outputLabel value="Confirma a senha:" for="senha2"/>
			            	<p:password id="senha2" value="#{usuarioMBean.usuario.senha}"/>
			            	
			            	<p:spacer height="35px"/>
			            	
		  				    <f:facet name="footer">
					  				<p:commandButton icon="ui-icon ui-icon-disk" update=":form02Id:display01Id,:form01Id:dataTable01Id" value="Salvar" action="#{usuarioMBean.editar()}" oncomplete="handleEdita(xhr, status, args)" title="Salvar" style="width:100px;"/>
					  				<p:commandButton icon="ui-icon-circle-triangle-w" value="Cancelar" onclick="editaUsuarioDialog.hide()" immediate="true" title="Cancelar" style="width:100px; left:100%"/>
					  		</f:facet>
					</p:panelGrid>
					
				</p:panel>
				
			</h:form>
			
		</p:dialog>

		<p:dialog header="Novo Usuário" 
				  widgetVar="novoUsuarioDialog" 
				  resizable="false" id="novoUsuarioDlgId" 
				  showEffect="fade" hideEffect="fade"  
				  modal="true"
				  closeOnEscape="true"
				  responsive="true">
			
			<h:form id="form03Id">
			
				<h:panelGroup id="novoUsuarioPanel" layout="block" styleClass="ui-fluid">
			
					<p:messages id="msgs3" autoUpdate="true" />
					
					<p:panelGrid id="display03Id" columns="2" cellpadding="6" 
							layout="grid"
							columnClasses="ui-grid-col-6, ui-grid-col-6"
							styleClass="panelgrid-noborder">
					
					   	<p:outputLabel value="Funcionário:" for="funcionario"/>
						<p:selectOneMenu id="funcionario" value="#{usuarioMBean.usuario.funcionario.codigo}" required="true" requiredMessage="É necessário selecionar um funcionário"
										 style="width:100%">
					    	<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{selectOneMenuMBean.listaFuncionarios}"/>
						</p:selectOneMenu>
						
	  		  		    <p:outputLabel value="Login:"/>
	  				    <p:inputText id="login" value="#{usuarioMBean.usuario.login}" required="true" 
	  				    			requiredMessage="É necessário informar o login do usuário" style="width:100%"/>
	  				    
	            		<p:outputLabel value="Senha:" for="senha1"/>
	            		<p:password id="senha1" value="#{usuarioMBean.usuario.senha}" match="senha2" required="true" requiredMessage="É necessário informar a senha" 
	            					validatorMessage="As senhas informadas são diferentes" style="width:100%"/>
	            		
	            		<p:outputLabel value="Confirma a senha:" for="senha2" />
	            		<p:password id="senha2" value="#{usuarioMBean.usuario.senha}" required="true" requiredMessage="É necessário confirmar a senha" style="width:100%"/>
	            		
	            		<f:facet name="footer">
				  				<p:commandButton icon="fa fa-floppy-o" update=":form03Id:display03Id,:form01Id:dataTable01Id" value="Salvar" actionListener="#{usuarioMBean.salvar}" title="Salvar" style="width:48%"/>
				  				<p:spacer width="1%"/>
				  				<p:commandButton icon="fa fa-times " value="Fechar" onclick="novoUsuarioDialog.hide()" immediate="true" title="Fechar" style="width:48%"/>
			  			</f:facet>
			  			
					</p:panelGrid>
					
			</h:panelGroup>
				
			</h:form>
			
		</p:dialog>

		<p:dialog id="basicDialogId" header="Atenção ao excluir" widgetVar="dlg1" resizable="false" showEffect="fade" hideEffect="fade" modal="false" width="500" height="80" position="center">
	  		<p:panelGrid id="display02Id" cellpadding="4" style="font-size:12px; font-family:Verdana">
	  	  		<p:outputLabel value="Deseja mesmo excluir este registro?" />
	  	  		<f:facet name="footer">
	              	<p:commandButton id="confirm" value="Sim" oncomplete="dlg1.hide()" update=":form01Id:dataTable01Id" action="#{usuarioMBean.remover()}" style="font-size:12px; width:50px; height:30px"/>
		  	 		<p:commandButton id="decline" value="Não" onclick="dlg1.hide()" type="button" style="font-size:12px; width:50px; height:30px"/>
            	</f:facet>
	  		</p:panelGrid>
		</p:dialog>

	</ui:define>

</ui:composition>